# 2025 CKA ì‹œí—˜ ì¤€ë¹„ í•µì‹¬ ìš”ì•½

## ëª©ì°¨

### 1. ì„¤ì¹˜ & í™˜ê²½ êµ¬ì„±
- [deb íŒ¨í‚¤ì§€ ì„¤ì¹˜](#1-deb-íŒ¨í‚¤ì§€-ì„¤ì¹˜)
- [Calico ì„¤ì¹˜](#2-calico-ì„¤ì¹˜)
- [Flannel ì„¤ì¹˜](#3-flannel-ì„¤ì¹˜)
- [Helm](#4-helm)
- [Kustomize](#5-kustomize)

### 2. ê¶Œí•œ & ë³´ì•ˆ
- [PriorityClass](#1-priorityclass)
- [Pod Security Admission(PSA)](#2-pod-security-admission)
- [SecurityContext](#3-securitycontext)
- [Default Mode](#4-default-mode)
- [Taint ì¢…ë¥˜](#5-taint-ì¢…ë¥˜)
- [Affinity](#6-affinity)
- [PV Node Affinity](#7-pv-node-affinity)

### 3. ì›Œí¬ë¡œë“œ
- [HPA](#1-hpa)
- [SideCar](#2-sidecar)
- [Node ìì› ê´€ë¦¬](#3-node-ìì›-ê´€ë¦¬)
- [kubectl label](#4-kubectl-label)
- [Downward API](#5-downward-api)
- [Pod ë¬¸ì œ í•´ê²°](#6-pod-ë¬¸ì œ-í•´ê²°)

### 4. Service & Network
- [Service - expose](#1-service-expose)
- [NetworkPolicy](#2-networkpolicy)
- [NodePort](#3-nodeport)
- [Headless Service + StatefulSet](#4-headless-service--statefulset)
- [Ingress to Gateway API](#5-ingress-to-gateway-api)
- [HTTPRoute](#6-httproute)
- [Ingress](#7-ingress)

### 5. ìŠ¤í† ë¦¬ì§€
- [StorageClass](#1-storageclass)
- [PV ë³µêµ¬](#2-pv-ë³µêµ¬)
- [Volume, ConfigMap - subPath](#3-volume-configmap-subpath)

### 6. ì¶œë ¥ & ì¡°íšŒ
- [explain ê²°ê³¼ ì¡°íšŒ](#1-explain-ê²°ê³¼-ì¡°íšŒ)
- [JSONPath ì‚¬ìš©](#2-jsonpath-ì‚¬ìš©)

### 7. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
- [ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°](#ì¼ë°˜ì ì¸-ë¬¸ì œ-í•´ê²°)

### 8. ê¸°íƒ€ íŒ & ëª…ë ¹ì–´
- [ìœ ìš©í•œ ëª…ë ¹ì–´](#ìœ ìš©í•œ-ëª…ë ¹ì–´)

---

## 1. ì„¤ì¹˜ & í™˜ê²½ êµ¬ì„±

### 1. deb íŒ¨í‚¤ì§€ ì„¤ì¹˜

**Question No: 11**

Complete these tasks to prepare the system for Kubernetes:

Set up cri-dockerd:
- Install the Debian package: `~/cri-dockerd_0.3.9.3-0.ubuntu-focal_amd64.deb`
- Start the cri-dockerd service
- Enable and start the systemd service for cri-dockerd

Configure these system parameters:
- Set `net.bridge.bridge-nf-call-iptables` to 1
- Set `net.ipv6.conf.all.forwarding` to 1
- Set `net.ipv4.ip_forward` to 1

**ì°¸ê³  ë¬¸ì„œ:**
- https://kubernetes.io/docs/setup/production-environment/container-runtimes/

```bash
# deb íŒ¨í‚¤ì§€ ì„¤ì¹˜
dpkg -i ~/cri-dockerd_0.3.9.3-0.ubuntu-focal_amd64.deb

# ì„œë¹„ìŠ¤ ì‹¤í–‰ ë° í™œì„±í™”
sudo systemctl enable --now cri-docker
sudo systemctl status cri-docker

# ì‹œìŠ¤í…œ ë§¤ê°œë³€ìˆ˜ êµ¬ì„±
cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1
net.bridge.bridge-nf-call-iptables = 1
EOF

# ì¬ë¶€íŒ… ì—†ì´ ì ìš©
sudo sysctl --system

# í™•ì¸
sysctl net.ipv4.ip_forward
sysctl net.ipv6.conf.all.forwarding
sysctl net.bridge.bridge-nf-call-iptables
```

### 2. Calico ì„¤ì¹˜

**ì¡°ê±´:** NetworkPolicy ì§€ì›ì´ í•„ìš”í•œ ê²½ìš°

The CNI you choose must satisfy following requirement: `<native network policy support>`

Install and configure a Container Network Interface (CNI) that satisfies the following conditions:

- Calico using the manifest: https://raw.githubusercontent.com/projectcalico/calico/v3.29.2/manifests/tigera-operator.yaml

The chosen CNI must allow:
- Pod-to-Pod communication
- NetworkPolicy enforcement
- Must be installed using manifest files (do not use Helm)

```bash
# Calico ì„¤ì¹˜ (create ì‚¬ìš©!)
kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.29.2/manifests/tigera-operator.yaml

# í…ŒìŠ¤íŠ¸
kubectl run test1 --image=busybox --restart=Never -- sleep 3600
kubectl run test2 --image=busybox --restart=Never -- sleep 3600
kubectl exec test1 -- ping -c 4 test2

# Calico pod ìƒì„± í™•ì¸
kubectl get pods -n kube-system
```

### 3. Flannel ì„¤ì¹˜

**ì¡°ê±´:** ë‹¨ìˆœ Pod ê°„ í†µì‹ ë§Œ í•„ìš”í•œ ê²½ìš°

```bash
# Flannel ì„¤ì¹˜
kubectl apply -f https://github.com/flannel-io/flannel/releases/download/v0.26.1/kube-flannel.yml

# í™•ì¸
kubectl get pods -n kube-flannel
```

### 4. Helm

#### CRD ê´€ë¦¬
- CRD = Custom Resource Definition (ì‚¬ìš©ì ì •ì˜ ë¦¬ì†ŒìŠ¤ ì •ì˜)
- ì‚¬ì´ì¦ˆê°€ í¬ê¸° ë•Œë¬¸ì— CRDê°€ ìˆëŠ” íŒŒì¼ì€ `kubectl create -f`ë¡œ ì„¤ì¹˜

#### Helm Template
Helm chartë¥¼ ì‹¤ì œë¡œ Kubernetesì— ì„¤ì¹˜í•˜ì§€ ì•Šê³ , ìƒì„±ë  ë¦¬ì†ŒìŠ¤ë“¤ì„ YAML í˜•íƒœë¡œ ì¶œë ¥

```bash
# Template ìƒì„±
helm template argocd argo/argo-cd --version 7.7.3 -n argocd \
  --set crds.install=false > ~/argo-helm.yaml

# Values í™•ì¸
helm show values argo/argo-cd --version 7.7.3

# ê¸°ì¡´ release values ì¡°íšŒ
helm get values kocoon-hermes -n logging
```

#### Helm Install
```bash
# Repository ì¶”ê°€
helm repo add argo https://argoproj.github.io/argo-helm

# CRD ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš°
helm install argocd argo/argo-cd --version 7.7.3 --skip-crds
# ë˜ëŠ”
helm install argocd argo/argo-cd --version 7.7.3 --set crds.install=false
```

#### Helm Pull
```bash
# Chart ë‹¤ìš´ë¡œë“œ ë° ì••ì¶• í•´ì œ
helm pull argo/argo-cd --version 7.7.3 --untar --untardir ./charts
```

### 5. Kustomize

```bash
# ë””ë ‰í† ë¦¬ êµ¬ì¡°
my-kustomize/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ kustomization.yaml
â””â”€â”€ overlays/
    â””â”€â”€ prod/
        â”œâ”€â”€ kustomization.yaml
        â””â”€â”€ deployment-patch.yaml
```

```yaml
# overlays/prod/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base

namespace: prod
namePrefix: prod-

commonLabels:
  env: prod

patchesStrategicMerge:
  - deployment-patch.yaml
```

```bash
# ë¦¬ì†ŒìŠ¤ ìƒì„±
kubectl apply -k overlays/prod

# ê²°ê³¼ í™•ì¸ (ì ìš©í•˜ì§€ ì•Šê³ )
kubectl kustomize overlays/prod

# YAML íŒŒì¼ë¡œ ì €ì¥
kubectl kustomize overlays/prod > /root/final.yaml
```

---

## 2. ê¶Œí•œ & ë³´ì•ˆ

### 1. PriorityClass

ë¦¬ì†ŒìŠ¤ê°€ ë¶€ì¡±í•  ë•Œ "ëˆ„êµ´ ë¨¼ì € ì£½ì´ê³  ëˆ„êµ´ ì‚´ë¦´ì§€" ê²°ì •í•˜ëŠ” ê¸°ì¤€

**ë¬¸ì œ ì˜ˆì‹œ:**
Create a new PriorityClass named `high-priority` for user workloads with a value that is one less than the highest existing user-defined priority class value.

```bash
# PriorityClass ìƒì„±
kubectl create priorityclass high-priority --value=999

# Deploymentì— ì ìš©
kubectl patch deployment busybox-logger -n priority \
  -p '{"spec":{"template":{"spec":{"priorityClassName":"high-priority"}}}}'

# ê°•ì œ ì¬ì‹œì‘ (í•„ìš”ì‹œ)
kubectl rollout restart deployment busybox-logger -n priority
```

```yaml
# Deploymentì—ì„œ ì„¤ì •
spec:
  template:
    spec:
      priorityClassName: high-priority
      preemptionPolicy: PreemptLowerPriority  # ê¸°ë³¸ê°’
```

**PreemptionPolicy ì˜µì…˜:**
- `PreemptLowerPriority` (ê¸°ë³¸ê°’): ìì‹ ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë‚®ì€ podë¥¼ ì«“ì•„ë‚¼ ìˆ˜ ìˆìŒ
- `Never`: ì ˆëŒ€ë¡œ ë‹¤ë¥¸ podë¥¼ ì«“ì•„ë‚´ì§€ ì•ŠìŒ

### 2. Pod Security Admission(PSA)

PodSecurityPolicy (PSP)ëŠ” Kubernetes 1.25ì—ì„œ ì™„ì „íˆ ì œê±°ë¨
PSAëŠ” Pod ìì²´ê°€ ì•„ë‹Œ Namespaceì— ë ˆì´ë¸”ì„ ë¶™ì—¬ì„œ í•´ë‹¹ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ ëª¨ë“  Podì„ ì œì–´

**ë ˆì´ë¸” ì¢…ë¥˜:**
- `pod-security.kubernetes.io/enforce`: ì ìš©í•  ëª¨ë“œ
- `pod-security.kubernetes.io/enforce-version`: ë³´ì•ˆ ì •ì±… ë²„ì „
- `pod-security.kubernetes.io/warn`: ê²½ê³ ë§Œ í‘œì‹œ
- `pod-security.kubernetes.io/audit`: ë¡œê·¸ì—ë§Œ ê¸°ë¡

**ë³´ì•ˆ ëª¨ë“œ:**
- `privileged`: ì œí•œ ê±°ì˜ ì—†ìŒ
- `baseline`: ìµœì†Œí•œì˜ ì œì•½
- `restricted`: ê°€ì¥ ë³´ì•ˆ ìˆ˜ì¤€ì´ ë†’ì€ ëª¨ë“œ

```bash
# ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„± ë° ì •ì±… ì ìš©
kubectl create ns secure-ns
kubectl label ns secure-ns \
  pod-security.kubernetes.io/enforce=restricted \
  pod-security.kubernetes.io/enforce-version=latest

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¼ë²¨ í™•ì¸
kubectl get ns --show-labels
```

### 3. SecurityContext

ì»¨í…Œì´ë„ˆ ë˜ëŠ” Pod ìˆ˜ì¤€ì—ì„œ ë³´ì•ˆ ê´€ë ¨ ì„¤ì •ì„ ì§€ì •

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  securityContext:         # Pod ìˆ˜ì¤€
    runAsNonRoot: true
    fsGroup: 2000         # ë³¼ë¥¨ ì ‘ê·¼ ì‹œ group ê¶Œí•œ

  containers:
  - name: nginx
    image: nginx
    securityContext:       # ì»¨í…Œì´ë„ˆ ìˆ˜ì¤€
      privileged: false
      allowPrivilegeEscalation: false
      runAsUser: 1000
      capabilities:
        add: ["SYS_TIME"]
        drop: ["ALL"]
      readOnlyRootFilesystem: true
```

**Restricted ëª¨ë“œì—ì„œ í•„ìˆ˜ ì„¤ì •:**
- `runAsNonRoot: true` âœ… í•„ìˆ˜
- `allowPrivilegeEscalation: false` âœ… í•„ìˆ˜
- `capabilities.drop: ["ALL"]` âœ… ê¶Œì¥
- `privileged: false` âœ… í•„ìˆ˜

### 4. Default Mode

ConfigMap, Secret ë“±ì„ Pod ì•ˆì— íŒŒì¼ë¡œ ë§ˆìš´íŠ¸í•  ë•Œ íŒŒì¼ ê¶Œí•œ ì„¤ì •

```yaml
volumes:
- name: config-vol
  configMap:
    name: my-config
    defaultMode: 0400   # íŒŒì¼ í¼ë¯¸ì…˜ ì„¤ì •
```

**ì£¼ì˜ì‚¬í•­:**
- íŒŒì¼ì—ë§Œ ì ìš©ë¨ (ë””ë ‰í† ë¦¬ëŠ” 0755ë¡œ ê³ ì •)
- configMap, secret, downwardAPI ë³¼ë¥¨ì—ë§Œ ì ìš©
- ì¼ë°˜ ë³¼ë¥¨(emptyDir, hostPath, PVC)ì—ëŠ” ì ìš© ì•ˆë¨

### 5. Taint ì¢…ë¥˜

ë…¸ë“œì— ì¡°ê±´ì„ ê±¸ì–´ì„œ íŠ¹ì • Podë§Œ ì˜¬ë¼ì˜¬ ìˆ˜ ìˆê²Œ ë§‰ëŠ” ê¸°ëŠ¥

**Taint íš¨ê³¼:**
- `NoSchedule`: Podì´ ìŠ¤ì¼€ì¤„ë˜ì§€ ì•ŠìŒ
- `NoExecute`: ê¸°ì¡´ Podë„ ì¦‰ì‹œ eviction
- `PreferNoSchedule`: ê°€ëŠ¥í•˜ë©´ ìŠ¤ì¼€ì¤„í•˜ì§€ ì•ŠìŒ

```bash
# Taint í™•ì¸
kubectl describe node node1 | grep Taint

# Toleration ì„¤ì •
```

```yaml
spec:
  tolerations:
  - key: "node-role.kubernetes.io/master"
    operator: "Exists"
    effect: "NoSchedule"
  
  # NoExecuteì˜ ê²½ìš°
  - key: "zone"
    operator: "Equal"
    value: "test"
    effect: "NoExecute"
    tolerationSeconds: 60  # 60ì´ˆ í›„ eviction
```

### 6. Affinity

#### Node Affinity
íŠ¹ì • ë…¸ë“œì— íŒŒë“œ ë°°ì¹˜ ìœ ë„

```yaml
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: disktype
            operator: In
            values:
            - ssd
      
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 80
        preference:
          matchExpressions:
          - key: availability-zone
            operator: In
            values:
            - zone1
```

#### Pod Affinity/Anti-Affinity

```yaml
spec:
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: security
            operator: In
            values:
            - S1
        topologyKey: topology.kubernetes.io/zone
    
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: security
              operator: In
              values:
              - S2
          topologyKey: topology.kubernetes.io/zone
```

**TopologyKey ê°’:**
- `topology.kubernetes.io/zone`: ê°™ì€ zone
- `kubernetes.io/hostname`: ê°™ì€ ë…¸ë“œ

### 7. PV Node Affinity

PVì— node affinityê°€ ìˆìœ¼ë©´, í•´ë‹¹ PVë¥¼ ì‚¬ìš©í•˜ëŠ” Podë„ í•´ë‹¹ ë…¸ë“œì— ë– ì•¼ í•¨

```yaml
# PVì—ì„œì˜ nodeAffinity
spec:
  nodeAffinity:
    required:
      nodeSelectorTerms:
      - matchExpressions:
        - key: disktype
          operator: In
          values:
          - ssd

# Podì—ì„œ íŠ¹ì • ë…¸ë“œ ì§€ì •
spec:
  nodeSelector:
    kubernetes.io/hostname: node02
```

---

## 3. ì›Œí¬ë¡œë“œ

### 1. HPA

**ë¬¸ì œ ì˜ˆì‹œ:**
Create a new HorizontalPodAutoscaler (HPA) named `apache-server` in the `autoscale` namespace targeting 50% CPU usage.

```bash
# HPA ìƒì„± (ëª…ë ¹í˜•)
kubectl autoscale deployment apache-server -n autoscale --min=1 --max=4 --cpu-percent=50

# HPA í¸ì§‘ (behavior ì¶”ê°€)
kubectl edit hpa apache-server -n autoscale
```

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: apache-server
  namespace: autoscale
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: apache-server
  minReplicas: 1
  maxReplicas: 4
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 50
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 30
```

### 2. SideCar

**ë¬¸ì œ ì˜ˆì‹œ:**
Update the existing deployment `synergy-leverager`, adding a co-located container named `sidecar` using the `busybox:stable` image.

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: synergy-leverager
spec:
  template:
    spec:
      containers:
      - name: app
        image: nginx:latest
        volumeMounts:
        - name: log-volume
          mountPath: /var/log
      
      - name: sidecar
        image: busybox:stable
        command: ["/bin/sh", "-c", "tail -n+1 -f /var/log/synergy-leverager.log"]
        volumeMounts:
        - name: log-volume
          mountPath: /var/log
      
      volumes:
      - name: log-volume
        emptyDir: {}
```

**Multi-Container Pod ì˜ˆì‹œ:**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mc-pod
  namespace: mc-namespace
spec:
  containers:
  - name: mc-pod-1
    image: nginx:1-alpine
    env:
    - name: NODE_NAME
      valueFrom:
        fieldRef:
          fieldPath: spec.nodeName
  
  - name: mc-pod-2
    image: busybox:1
    command:
    - sh
    - -c
    - "while true; do date >> /var/log/shared/date.log; sleep 1; done"
    volumeMounts:
    - mountPath: /var/log/shared
      name: cache-volume
  
  - name: mc-pod-3
    image: busybox:1
    command:
    - sh
    - -c
    - "tail -f /var/log/shared/date.log"
    volumeMounts:
    - mountPath: /var/log/shared
      name: cache-volume
  
  volumes:
  - name: cache-volume
    emptyDir: {}
```

### 3. Node ìì› ê´€ë¦¬

**ë¬¸ì œ:** WordPress ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Pod ë¦¬ì†ŒìŠ¤ë¥¼ ë…¸ë“œ ìì›ì˜ 1/3ë¡œ ê· ë“± ë¶„ë°°

```bash
# ë…¸ë“œ ìì› í™•ì¸
kubectl describe node | grep -i allocatable -A5

# ë¦¬ì†ŒìŠ¤ ìš”ì²­ ì„¤ì • (3ë“±ë¶„)
resources:
  requests:
    memory: "2Gi"
    cpu: "1"
```

### 4. kubectl label

```bash
# ë¼ë²¨ ì¶”ê°€
kubectl label pod my-pod app=web

# ë¼ë²¨ ìˆ˜ì •
kubectl label pod my-pod app=backend --overwrite

# ë¼ë²¨ ì‚­ì œ
kubectl label pod my-pod app-
```

### 5. Downward API

í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ Pod ì•ˆìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ì‹

```yaml
# í™˜ê²½ ë³€ìˆ˜ë¡œ ì „ë‹¬
env:
- name: MY_POD_NAME
  valueFrom:
    fieldRef:
      fieldPath: metadata.name

- name: CPU_REQUEST
  valueFrom:
    resourceFieldRef:
      resource: requests.cpu
      divisor: 1Mi

# ë³¼ë¥¨ íŒŒì¼ë¡œ ì „ë‹¬
volumeMounts:
- name: podinfo
  mountPath: /etc/podinfo
  readOnly: true

volumes:
- name: podinfo
  downwardAPI:
    items:
    - path: "pod_name"
      fieldRef:
        fieldPath: metadata.name
```

### 6. Pod ë¬¸ì œ í•´ê²°

**ì¼ë°˜ì ì¸ ë¬¸ì œ:**
- `0/3 nodes are available: 1 Insufficient cpu, 2 Insufficient memory`

**í•´ê²° ë°©ë²•:**
1. ë…¸ë“œ ë¦¬ì†ŒìŠ¤ í™•ì¸: `kubectl describe nodes | grep -i allocatable -A5`
2. Pod requests ê°’ ì¤„ì´ê¸°
3. íŠ¹ì • ë…¸ë“œì— ê°•ì œ ë°°ì¹˜

```yaml
# nodeName ì‚¬ìš© (ìŠ¤ì¼€ì¤„ëŸ¬ ê±´ë„ˆë›°ê¸°)
spec:
  nodeName: node01

# nodeSelector ì‚¬ìš© (ìŠ¤ì¼€ì¤„ëŸ¬ í™œìš©)
spec:
  nodeSelector:
    kubernetes.io/hostname: node01
```

---

## 4. Service & Network

### 1. Service - expose

```bash
# ClusterIP ì„œë¹„ìŠ¤ ìƒì„±
kubectl expose pod messaging --port=6379 --name=messaging-service

# NodePort ì„œë¹„ìŠ¤ ìƒì„±
kubectl expose deployment front-end --name=front-end-svc --port=80 --type=NodePort
```

**ì°¸ê³ :** `kubectl expose` ëª…ë ¹ì–´ëŠ” Podì˜ containerPortë¥¼ ìë™ìœ¼ë¡œ targetPortë¡œ ì‚¬ìš©

### 2. NetworkPolicy

**ëª¨ë“  ingress ìš”ì²­ í—ˆìš©:**

```yaml
spec:
  ingress:
  - ports:
    - protocol: TCP
      port: 80
```

**ë³µí•© NetworkPolicy ì˜ˆì‹œ:**

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: app-security
  namespace: secure-app
spec:
  podSelector:
    matchLabels:
      app: backend
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - ipBlock:
        cidr: 172.16.0.0/16
        except:
        - 172.16.1.0/24
    - namespaceSelector:
        matchLabels:
          env: trusted
    - podSelector:
        matchLabels:
          role: frontend
    ports:
    - protocol: TCP
      port: 8080
  egress:
  - to:
    - ipBlock:
        cidr: 10.0.0.0/24
    ports:
    - protocol: TCP
      port: 5432
```

### 3. NodePort

```yaml
apiVersion: v1
kind: Service
metadata:
  name: front-end-svc
spec:
  type: NodePort
  selector:
    app: front-end
  ports:
  - port: 80
    targetPort: 80
    nodePort: 30080
```

### 4. Headless Service + StatefulSet

ê³ ì •ëœ DNSëŠ” Headless Serviceê°€ ìˆì–´ì•¼ ê°€ëŠ¥

```yaml
# StatefulSet
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: web
spec:
  serviceName: web  # ì¤‘ìš”!
  replicas: 2

---
# Headless Service
apiVersion: v1
kind: Service
metadata:
  name: web
spec:
  clusterIP: None  # í•µì‹¬!
  selector:
    app: web
```

**ê²°ê³¼:** `web-0.web.default.svc.cluster.local`, `web-1.web.default.svc.cluster.local`

### 5. Ingress to Gateway API

**ê¸°ì¡´ Ingress:**

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: web
spec:
  tls:
  - hosts:
    - gateway.web.k8s.local
    secretName: web-tls
  rules:
  - host: gateway.web.k8s.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web-service
            port:
              number: 80
```

**Gatewayë¡œ ë³€í™˜:**

```yaml
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: web-gateway
spec:
  gatewayClassName: nginx
  listeners:
  - name: https
    protocol: HTTPS
    port: 443
    hostname: gateway.web.k8s.local
    tls:
      certificateRefs:
      - kind: Secret
        name: web-tls
```

### 6. HTTPRoute

```yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: web-route
spec:
  parentRefs:
  - name: web-gateway
  hostnames:
  - "gateway.web.k8s.local"
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /
    backendRefs:
    - name: web-service
      port: 80
```

### 7. Ingress

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kodekloud-ingress
spec:
  ingressClassName: nginx
  rules:
  - host: kodekloud-ingress.app
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: webapp-svc
            port:
              number: 80
```

---

## 5. ìŠ¤í† ë¦¬ì§€

### 1. StorageClass

**ë¬¸ì œ ì˜ˆì‹œ:**
Create a new StorageClass named `local-path` for an existing provisioner named `rancher.io/local-path`. Set as default.

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-path
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: rancher.io/local-path
volumeBindingMode: WaitForFirstConsumer
```

**ê¸°ë³¸ StorageClass ì„¤ì •:**
1. ê¸°ì¡´ ê¸°ë³¸ StorageClassì—ì„œ annotation ì œê±°
2. ìƒˆ StorageClassì— `storageclass.kubernetes.io/is-default-class: "true"` ì¶”ê°€

### 2. PV ë³µêµ¬

**ë¬¸ì œ ì˜ˆì‹œ:**
A MariaDB Deployment was deleted. Restore it using existing retained PV.

```yaml
# PVC ìƒì„±
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mariadb
  namespace: mariadb
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 250Mi
  storageClassName: standard

---
# Deployment ë³µêµ¬
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mariadb
  namespace: mariadb
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mariadb
  template:
    metadata:
      labels:
        app: mariadb
    spec:
      containers:
      - name: mariadb
        image: mariadb:latest
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "password"
        volumeMounts:
        - name: data
          mountPath: /var/lib/mysql
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: mariadb
```

### 3. Volume, ConfigMap - subPath

subPathë¥¼ ì‚¬ìš©í•˜ë©´ ConfigMap ì¤‘ì—ì„œ íŠ¹ì • keyë§Œ íŒŒì¼ë¡œ ì €ì¥ ê°€ëŠ¥

```yaml
volumeMounts:
- name: config-volume
  mountPath: /etc/nginx/nginx.conf
  subPath: nginx.conf

volumes:
- name: config-volume
  configMap:
    name: nginx-config
```

---

## 6. ì¶œë ¥ & ì¡°íšŒ

### 1. explain ê²°ê³¼ ì¡°íšŒ

```bash
# ë¦¬ì†ŒìŠ¤ ìŠ¤í™ í™•ì¸
kubectl explain pod.spec.containers.resources

# íŠ¹ì • í•„ë“œ ì„¤ëª…
kubectl explain deployment.spec.strategy
```

### 2. JSONPath ì‚¬ìš©

```bash
# ë…¸ë“œ OS ì •ë³´ ì¶”ì¶œ
kubectl get nodes -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.status.nodeInfo.osImage}{"\n"}{end}' > /tmp/node-os-info.txt

# Pod IP ì¶”ì¶œ
kubectl get pods -o jsonpath='{.items[*].status.podIP}'

# íŠ¹ì • í•„ë“œ ì •ë ¬
kubectl get pods --sort-by='.metadata.creationTimestamp'
kubectl get pods --sort-by='.metadata.uid'
```

---

## 7. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°

**Podì´ Pending ìƒíƒœ:**
```bash
kubectl describe pod <pod-name>
kubectl get events --sort-by='.lastTimestamp'
```

**ì¼ë°˜ì ì¸ ì›ì¸:**
- ë¦¬ì†ŒìŠ¤ ë¶€ì¡± (CPU/Memory)
- Node Taint
- PVC ë°”ì¸ë”© ì‹¤íŒ¨
- Image Pull ì‹¤íŒ¨

**Nodeê°€ NotReady:**
```bash
kubectl describe node <node-name>

# Nodeì— SSH ì ‘ì† í›„
sudo systemctl status kubelet
sudo systemctl status containerd
sudo journalctl -u kubelet -f

# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart kubelet
sudo systemctl enable kubelet
```

---

## 8. ê¸°íƒ€ íŒ & ëª…ë ¹ì–´

### ìœ ìš©í•œ ëª…ë ¹ì–´

```bash
# kubectl ë‹¨ì¶•í‚¤
alias k=kubectl
export do="--dry-run=client -o yaml"
export now="--force --grace-period 0"

# ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´
k get po -A
k describe po <pod-name>
k logs <pod-name> -f
k edit <resource> <name>
k delete po <pod-name> $now

# ë¦¬ì†ŒìŠ¤ ìƒì„± í…œí”Œë¦¿
k run nginx --image=nginx $do > nginx.yaml
k create deploy web --image=nginx $do > web.yaml
k expose pod nginx --port=80 $do > svc.yaml
```

### Vim ì„¤ì •

```bash
# ~/.vimrc
set expandtab
set tabstop=2
set shiftwidth=2
set number
```

### ì‹œí—˜ íŒ

1. **ì‹œê°„ ê´€ë¦¬:** ì´ 2ì‹œê°„, ë¬¸ì œë‹¹ í‰ê·  5-8ë¶„
2. **ì–´ë ¤ìš´ ë¬¸ì œëŠ” ë‚˜ì¤‘ì—:** ì‰¬ìš´ ë¬¸ì œë¶€í„° í•´ê²°
3. **ê³µì‹ ë¬¸ì„œ í™œìš©:** https://kubernetes.io/docs/
4. **ëª…ë ¹ì–´ ìš°ì„ :** ê°€ëŠ¥í•˜ë©´ kubectl ëª…ë ¹ì–´ ì‚¬ìš©
5. **ê²€ì¦ í•„ìˆ˜:** ìƒì„± í›„ ë°˜ë“œì‹œ ë™ì‘ í™•ì¸

### ìì£¼ ì‚¬ìš©í•˜ëŠ” ì°¸ê³  ë¬¸ì„œ

- **ì¼ë°˜:** https://kubernetes.io/docs/reference/kubectl/cheatsheet/
- **ë„¤íŠ¸ì›Œí‚¹:** https://kubernetes.io/docs/concepts/services-networking/
- **ìŠ¤í† ë¦¬ì§€:** https://kubernetes.io/docs/concepts/storage/
- **ë³´ì•ˆ:** https://kubernetes.io/docs/concepts/security/
- **ìŠ¤ì¼€ì¤„ë§:** https://kubernetes.io/docs/concepts/scheduling-eviction/

---

**Good Luck with your CKA Exam! ğŸš€**